# N8N Agent 配音提示词

本目录包含用于N8N Agent自动生成视频配音脚本的提示词模板。

## 文件说明

### 1. 视频配音提示词_简洁版.md
- **用途**：快速生成视频配音脚本
- **特点**：规则简洁，易于理解
- **适用场景**：短视频（<3分钟）、简单剧情

### 2. 视频配音提示词_优化版.md
- **用途**：深度理解画面，生成高质量配音脚本
- **特点**：画面分析详细，故事化表达
- **适用场景**：长视频（>3分钟）、复杂剧情、需要精细控制

## 使用流程

### 步骤1：在N8N中配置Agent

1. 创建N8N工作流
2. 添加AI Agent节点
3. 将提示词复制到Agent的System Prompt中
4. 配置输入变量：
   - `视频时长`：从视频元数据获取
   - `小说内容`：从数据源读取

### 步骤2：Agent生成配音脚本

Agent会根据提示词生成JSON格式的配音脚本：

```json
{
  "segments": [
    {
      "type": "dialogue",
      "start_ms": 0,
      "end_ms": 10000,
      "role_name": "旁白",
      "text": "...",
      "emotion": "叙述",
      "strength": "轻柔"
    }
  ],
  "project_id": 1,
  "return_srt": true
}
```

### 步骤3：调用智能配音API

将Agent生成的JSON发送到配音API：

```
POST http://localhost:8300/tts/timeline/dubbing
Content-Type: application/json

{生成的JSON}
```

### 步骤4：获取配音结果

API返回音频和字幕文件：

```json
{
  "code": 200,
  "data": {
    "audio_url": "/output/timeline/xxx/merged.wav",
    "srt_url": "/output/timeline/xxx/merged.srt"
  }
}
```

## N8N工作流示例

```
[视频输入] 
    ↓
[获取视频元数据] → 提取时长
    ↓
[读取小说内容]
    ↓
[AI Agent] → 使用提示词生成配音脚本
    ↓
[HTTP Request] → 调用智能配音API
    ↓
[保存结果] → 下载音频和字幕
```

## 提示词变量说明

### 必需变量

| 变量 | 说明 | 示例 |
|------|------|------|
| `{{ $('📊 获取元数据').item.json.response.duration }}` | 视频总时长（秒） | 141.410667 |
| `{{ $json.content }}` | 小说章节内容 | "破旧的茅草屋里..." |

### 可选变量

| 变量 | 说明 | 默认值 |
|------|------|--------|
| `project_id` | 项目ID | 1 |
| `return_srt` | 是否返回字幕 | true |

## 配合使用的API

1. **获取配音库**：`GET /voices/tts/1`
   - 查询可用音色列表
   - 了解角色名称和音色描述

2. **智能配音**：`POST /tts/timeline/dubbing`
   - 接收Agent生成的JSON
   - 生成配音音频和字幕

详细API文档请查看：
- [智能配音接口文档](../docs/API-智能配音接口.md)
- [获取配音库接口文档](../docs/API-获取配音库.md)

## 注意事项

1. **时间精确度**：最后segment的end_ms必须等于视频总毫秒数
2. **字数控制**：按3.3字/秒计算，避免配音超时
3. **角色名称**：必须与项目中配置的角色完全一致
4. **时间轴连续**：所有segment时间必须连续，无间隙无重叠

## 常见问题

### Q1: Agent生成的配音超时怎么办？
A: 检查字数是否超标，按`视频时长(秒) × 0.9 × 3.3`计算最大字数

### Q2: 如何调整配音质量？
A: 修改提示词中的情绪和强度参数，或使用优化版提示词

### Q3: 支持哪些角色？
A: 调用`GET /voices/tts/1`查看当前项目的音色库

### Q4: 异步模式如何使用？
A: 在请求中设置`"async_mode": true`，然后轮询查询任务状态

## 更新日志

- 2025-12-11: 初始版本，包含简洁版和优化版提示词
